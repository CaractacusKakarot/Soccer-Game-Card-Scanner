<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>AYSO Game Card Scanner • Coach Desk</title>

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme:{extend:{
        colors:{brand:{600:'#0f766e'}},
        boxShadow:{soft:'0 10px 28px rgba(0,0,0,.12)'},
        fontFamily:{sans:['Inter','ui-sans-serif','system-ui','sans-serif']}
      }}
    }
  </script>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400..800&display=swap" rel="stylesheet"/>

  <!-- Tesseract OCR -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
  <!-- FileSaver for CSV downloads -->
  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>

  <style>
    html,body{height:100%}
    .btn{background:linear-gradient(180deg,#12b3ac 0%,#0f766e 100%);color:white;
         border-radius:.5rem;padding:.5rem 1rem;font-weight:500;box-shadow:0 10px 28px rgba(0,0,0,.12)}
    .btn:hover{filter:brightness(1.05)}
    .btn-ghost{border:1px solid #d1d5db;padding:.5rem 1rem;border-radius:.5rem}
    .tab{padding:.5rem 1rem;border-radius:9999px;cursor:pointer}
    .tab-active{background:#0f172a;color:white}
    .tab-inactive{background:#f1f5f9;color:#334155}
  </style>
</head>
<body class="bg-white text-slate-900 font-sans">
  <!-- Header -->
  <header class="sticky top-0 z-40 bg-white/90 backdrop-blur border-b border-slate-200">
    <div class="mx-auto max-w-7xl px-4 h-16 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <span class="h-8 w-8 rounded-full bg-brand-600 inline-block"></span>
        <span class="font-semibold">Coach Desk — Game Card Scanner</span>
      </div>
      <nav class="hidden md:flex gap-2">
        <button class="tab tab-active" data-tab="scan">Scan</button>
        <button class="tab tab-inactive" data-tab="matches">Matches</button>
        <button class="tab tab-inactive" data-tab="standings">Standings</button>
        <button class="tab tab-inactive" data-tab="refs">Refs</button>
        <button class="tab tab-inactive" data-tab="export">Import/Export</button>
        <button class="tab tab-inactive" data-tab="settings">Settings</button>
      </nav>
    </div>
  </header>

  <!-- Main -->
  <main class="mx-auto max-w-7xl px-4 py-8 space-y-8">
    <!-- Scan Section -->
    <section id="tab-scan">
      <div class="p-6 border rounded-xl bg-white shadow-soft">
        <h2 class="text-lg font-semibold">Upload or Capture Game Card</h2>
        <p class="text-sm text-slate-600 mt-1">Use your phone camera or drag images here (JPG/PNG).</p>
        <div class="mt-4 flex flex-col gap-3">
          <input id="fileInput" type="file" accept="image/*" multiple capture="environment"
                 class="block w-full border border-slate-300 rounded-lg p-2"/>
          <div id="drop" class="rounded-xl border-2 border-dashed border-slate-300 p-6 text-center text-slate-500">
            Drop images here
          </div>
          <div id="preview" class="grid grid-cols-2 gap-3"></div>
          <div class="flex items-center gap-3">
            <button id="btnOCR" class="btn">Run OCR</button>
            <span id="ocrStatus" class="text-sm text-slate-600"></span>
          </div>
        </div>
      </div>
    </section>

    <!-- Matches -->
    <section id="tab-matches" class="hidden">
      <div class="p-6 border rounded-xl bg-white shadow-soft">
        <h2 class="text-lg font-semibold">Saved Matches</h2>
        <table class="mt-4 w-full border border-slate-200 text-sm" id="matchesTable">
          <thead class="bg-slate-100">
            <tr><th>Date</th><th>Game</th><th>Home</th><th>Away</th><th>Score</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- Standings -->
    <section id="tab-standings" class="hidden">
      <div class="p-6 border rounded-xl bg-white shadow-soft">
        <h2 class="text-lg font-semibold">Standings</h2>
        <table class="mt-4 w-full border border-slate-200 text-sm" id="standingsTable">
          <thead class="bg-slate-100">
            <tr><th>Team</th><th>W</th><th>D</th><th>L</th><th>Pts</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- Refs -->
    <section id="tab-refs" class="hidden">
      <div class="p-6 border rounded-xl bg-white shadow-soft">
        <h2 class="text-lg font-semibold">Referee Assignments</h2>
        <table class="mt-4 w-full border border-slate-200 text-sm" id="refsTable">
          <thead class="bg-slate-100"><tr><th>Name</th><th>CR</th><th>AR</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- Export -->
    <section id="tab-export" class="hidden">
      <div class="p-6 border rounded-xl bg-white shadow-soft">
        <h2 class="text-lg font-semibold">Export</h2>
        <button id="exportJSON" class="btn mt-3">Download JSON</button>
      </div>
    </section>
  </main>

  <footer class="border-t border-slate-200">
    <div class="mx-auto max-w-7xl px-4 py-8 text-sm text-slate-600 flex items-center justify-between">
      <span>© <span id="year"></span> Coach Desk</span>
    </div>
  </footer>

  <script>
  const $ = s=>document.querySelector(s);
  const $$ = s=>[...document.querySelectorAll(s)];
  const state = {matches:[]};

  // Tabs
  const tabs=$$('.tab');
  const sections={scan:$('#tab-scan'),matches:$('#tab-matches'),standings:$('#tab-standings'),refs:$('#tab-refs'),export:$('#tab-export')};
  tabs.forEach(btn=>{
    btn.addEventListener('click',()=>{
      tabs.forEach(b=>b.classList.replace('tab-active','tab-inactive'));
      btn.classList.replace('tab-inactive','tab-active');
      Object.entries(sections).forEach(([k,el])=>el.classList.toggle('hidden',k!==btn.dataset.tab));
    });
  });

  // File preview
  const drop=$('#drop'),fileInput=$('#fileInput'),preview=$('#preview');
  function handleFiles(files){
    preview.innerHTML='';
    [...files].forEach(f=>{
      const url=URL.createObjectURL(f);
      const img=document.createElement('img');
      img.src=url; img.className='w-full h-40 object-cover rounded-xl border';
      preview.appendChild(img);
    });
  }
  fileInput.addEventListener('change',e=>handleFiles(e.target.files));
  drop.addEventListener('drop',e=>{e.preventDefault();handleFiles(e.dataTransfer.files)});
  ['dragover','dragenter'].forEach(ev=>drop.addEventListener(ev,e=>e.preventDefault()));

  // OCR
  $('#btnOCR').addEventListener('click',async()=>{
    const files=fileInput.files;
    if(!files.length){alert('Upload a card first');return;}
    $('#ocrStatus').textContent='Scanning…';
    let text='';
    for(const f of files){
      const {data}=await Tesseract.recognize(f,'eng');
      text+=data.text+'\n';
    }
    $('#ocrStatus').textContent='Done. Text parsed.';
    // Example: store match
    state.matches.push({date:new Date().toISOString().split('T')[0],game:'Demo',home:'Team A',away:'Team B',score:'1-0'});
    renderMatches();
  });

  function renderMatches(){
    const tbody=$('#matchesTable tbody');
    tbody.innerHTML='';
    state.matches.forEach(m=>{
      tbody.innerHTML+=`<tr><td>${m.date}</td><td>${m.game}</td><td>${m.home}</td><td>${m.away}</td><td>${m.score}</td></tr>`;
    });
  }

  // Export JSON
  $('#exportJSON').addEventListener('click',()=>{
    const blob=new Blob([JSON.stringify(state,null,2)],{type:'application/json'});
    saveAs(blob,'matches.json');
  });

  $('#year').textContent=new Date().getFullYear();
  </script>
</body>
</html>
